# Как читать ARCHITECTURE.md

Ниже — краткая навигация по структуре с объяснением ключевых блоков и маркеров.

Порядок секций (типичный):
- AI Preamble — краткие инструкции и навигационная стратегия.
- Entrypoints & Public Surface — публичные API и entrypoints (top‑N по budget).
- Graph Hubs (Fan‑in / Fan‑out) — узловые файлы с большим входящим/исходящим трафиком.
- Focused Deep‑Dive — детальный view для `--focus-file` (importers / imports).
- Impact Path — кратчайшие outgoing пути от focus‑файла к PUBLIC‑API.
- Local Dependencies (Budgeted) — детализованные локальные зависимости (ограниченные списки).
- Project Tree — древовидное представление файлов и inline counts.

Сигналы (inline)
- (!) — критический риск (risk). Требует немедленного внимания.
- (?) — подозрительный / потенциальная проблема (warning/uncertain).
- (i) — информационная подсказка или рекомендация.
- (→) — навигационная отметка (например PUBLIC‑API, ENTRYPOINT).

Inline local deps counts
- В дереве файлы помечаются как `(←N →M)` — N = число локальных импортёров (incoming), M = число исходящих локальных импортов (outgoing).

Local Dependencies
- Секция показывает выбранные по бюджету файлы с их локальными входящими/исходящими импортами.
- При `--full-signals` бюджет не применяется и все элементы показываются.

Focused Deep‑Dive
- Активируется `--focus-file <path>`.
- Показывает две строки: `← Importers` и `→ Imports` — с бюджетным отсечением (например `… (+K more)`).

Task Capsule
- Активируется сочетанием `--focus-file` и `--focus-depth <K>`.
- Показано расширение K‑hop: все узлы внутри K шагов раскрыты, остальное собирается в deterministic stub‑строки вида:
```
… (X files, Y subdirs, (!) Z signals hidden)
```
- Stub‑строка фиксированного формата чтобы не раскрывать лишний шум, но сохранить количественный контекст.

Impact Path
- Показывает до PATH_BUDGET (по умолчанию 3) самых коротких направленных путей из focus‑файла к файлам, помеченным как PUBLIC‑API.
- Формат строки пути:
```
`<a>` → `<b>` → `<c>` (→ PUBLIC-API)
```
- Если найдено больше путей, будет добавлена строка:
```
… (+K more paths)
```
- При `--full-signals` показаны все пути (без truncation).

Короткий playbook агента при правке
1. Запустите `node dist/cli/main.js --focus-file <file>` чтобы увидеть Impact Path.
2. Если список усечён, добавьте `--full-signals` для полного контекста.
3. Проверяйте (!) сигналы в первую очередь.
4. Используйте task capsule (`--focus-depth`) чтобы избежать шумных деревьев при локальной правке.
